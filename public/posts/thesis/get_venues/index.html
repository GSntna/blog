<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #00a8e8;
            --font-size: 20px;
        }
    </style>

    
    
    
    
    
    

    
    <title>Creating venues database</title>
    <meta name="description" content="The goal of this process is to retrieve venues efficiently, prioritizing free APIs (OSM, Foursquare) and using Google Places only as a fallback.
Grid creation …">
    <meta name="keywords" content='blog, gustavo santana, data science, data engineer, business intelligence, data analysis, data, thesis, geospatial data, api, python'>

    <meta property="og:url" content="https://gustats.com/posts/thesis/get_venues/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Creating venues database">
    <meta property="og:description" content="The goal of this process is to retrieve venues efficiently, prioritizing free APIs (OSM, Foursquare) and using Google Places only as a fallback.
Grid creation …">
    <meta property="og:image" content="https://gustats.com/images/avatar.webp">
    <meta property="og:image:secure_url" content="https://gustats.com/images/avatar.webp">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Creating venues database">
    <meta name="twitter:description" content="The goal of this process is to retrieve venues efficiently, prioritizing free APIs (OSM, Foursquare) and using Google Places only as a fallback.
Grid creation …">
    <meta property="twitter:domain" content="https://gustats.com/posts/thesis/get_venues/">
    <meta property="twitter:url" content="https://gustats.com/posts/thesis/get_venues/">
    <meta name="twitter:image" content="https://gustats.com/images/avatar.webp">

    
    <link rel="canonical" href="https://gustats.com/posts/thesis/get_venues/">

    
    <link rel="stylesheet" type="text/css" href="/css/normalize.min.css" media="print">

    
    <link rel="stylesheet" type="text/css" href="/css/main.min.css">

    
    <link id="dark-theme" rel="stylesheet" href="/css/dark.min.css">

    
    <script src="/js/bundle.min.70293498aa96b2dbb767ec11a622eb2266d8fc37a0fff88233a82952e3c72b15.js" integrity="sha256-cCk0mKqWstu3Z&#43;wRpiLrImbY/Deg//iCM6gpUuPHKxU="></script>

    
    
        <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z17E0QP0VK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-Z17E0QP0VK');
    </script>

    <link rel="icon" type="image/x-icon" href="/images/logo.png">
  
    
</head>
<body>
        <script>
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        
        <div class="avatar">
            <a href="https://gustats.com/">
                <img src='/images/avatar.webp' alt="avatar">
            </a>
        </div>
        

        <div class="nav-title">
            <a class="nav-brand" href="https://gustats.com/">Gustavo Santana</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="https://gustats.com/" aria-label="" > Home </a>
            </div>
            
            <div class="nav-link">
                <a href="https://gustats.com/posts/" aria-label="" > Posts </a>
            </div>
            
            <div class="nav-link">
                <a href="https://gustats.com/categories/" aria-label="" > Categories </a>
            </div>
            
            <div class="nav-link">
                <a href="https://gustats.com/pdf/Gustavo_Santana.pdf" aria-label="" target="_blank"> Resume </a>
            </div>
            
            <div class="nav-link">
                <a href="https://github.com/GSntna" aria-label="github" target="_blank"><span data-feather='github'></span>  </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
                <a aria-hidden="true" role="switch">
                    <span class="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
                <a aria-checked="false" aria-labelledby="hamburger-menu-toggle" id="hamburger-menu-toggle-target" role="switch">
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="https://gustats.com/" > Home </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://gustats.com/posts/" > Posts </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://gustats.com/categories/" > Categories </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://gustats.com/pdf/Gustavo_Santana.pdf" target="_blank"> Resume </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://github.com/GSntna" target="_blank"><span data-feather='github'></span>  </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
                    <a role="switch">
                        <span class="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>Creating venues database</h1>

        

        
	
	
	
	
        

	

	

	
          <small role="doc-subtitle"></small>
	

	
          <p class="post-date">
              
                  3 min read |
              

              June 9, 2025

              
          </p>
	

        <ul class="post-tags">
          
           
             <li class="post-tag"><a href="https://gustats.com/tags/thesis">thesis</a></li>
           
         
           
             <li class="post-tag"><a href="https://gustats.com/tags/geospatial-data">geospatial data</a></li>
           
         
           
             <li class="post-tag"><a href="https://gustats.com/tags/api">api</a></li>
           
         
           
             <li class="post-tag"><a href="https://gustats.com/tags/python">python</a></li>
           
         
        </ul>
    </div>

    <div class="post-content">
        <p>The goal of this process is to retrieve venues efficiently, prioritizing free
APIs (OSM, Foursquare) and using Google Places only as a fallback.</p>
<h2 id="grid-creation">Grid creation</h2>
<ul>
<li>Objective: Create grids over the map to use the APIs over a smaller area to
handle their respective results limit.</li>
<li>Tools: <code>geopandas</code>, <code>shapely</code>,</li>
</ul>
<h3 id="step-by-step">Step by step</h3>
<h4 id="1-import-and-convert-to-utm-zone-13n">1. Import and convert to UTM Zone 13N</h4>
<p>The imported shape file is using <code>EPSG:4326</code> format, which means that the data
is in degrees (latitude/longitude), that can distort distances.</p>
<p>To ensure the grid accuracy, it is necessary to use meters by reproject the data
to <a href="https://epsg.io/32613">Guadalajara&rsquo;s UTM Zone</a>: <strong>UTM Zone 13</strong>
(<code>EPSG:32613</code>).</p>
<h4 id="2-create-grids">2. Create grids</h4>
<p>First, a square covering all of the neighborhoods is created by getting the
bounds (square corners). Then that square is divided in 1km x 1km squares:</p>
<p><img src="/images/masters_thesis/grids_zmg.png" alt="Grid over Zapopan and Guadalajara, Jalisco, Mexico"></p>
<p>Then, since we&rsquo;re interested on avoiding areas outside the studied neighborhoods,
we only keep grids that are intersecting with the neighborhoods on the shape
file:</p>
<p><img src="/images/masters_thesis/overlay_grids_zmg.png" alt="Grid overlaying Zapopan and Guadalajara&rsquo;s neighborhoods"></p>
<h4 id="3-get-grids-center-latlon">3. Get grids&rsquo; center (lat/lon)</h4>
<p>Since the APIs use latitude and longitude (degrees), the data is turned back to
degrees (<code>EPSG:4326</code>) and the center for each grid is retrieved. The associated
neighborhood for each grid is also added to easily filter by it.</p>
<p>The final output includes, the geometry of the 1x1km square, the latitude and
longitude of the center of the grids (for the APIs) and the neighborhood name:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">neighborhood</th>
          <th style="text-align: right">api_lon</th>
          <th style="text-align: right">api_lat</th>
          <th style="text-align: left">geometry</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">La primavera</td>
          <td style="text-align: right">-103.571</td>
          <td style="text-align: right">20.717</td>
          <td style="text-align: left">POLYGON ((649342.528&hellip; 2290987.127))</td>
      </tr>
      <tr>
          <td style="text-align: left">La primavera</td>
          <td style="text-align: right">-103.571</td>
          <td style="text-align: right">20.7261</td>
          <td style="text-align: left">POLYGON ((649342.528&hellip; 2291987.127))</td>
      </tr>
      <tr>
          <td style="text-align: left">Del carril</td>
          <td style="text-align: right">-103.571</td>
          <td style="text-align: right">20.7261</td>
          <td style="text-align: left">POLYGON ((649342.528&hellip; 2291987.127))</td>
      </tr>
      <tr>
          <td style="text-align: left">La primavera</td>
          <td style="text-align: right">-103.57</td>
          <td style="text-align: right">20.7351</td>
          <td style="text-align: left">POLYGON ((649342.528&hellip; 2292987.127))</td>
      </tr>
      <tr>
          <td style="text-align: left">El calabozo</td>
          <td style="text-align: right">-103.561</td>
          <td style="text-align: right">20.7169</td>
          <td style="text-align: left">POLYGON ((650342.528&hellip; 2290987.127))</td>
      </tr>
  </tbody>
</table>
<h3 id="code">Code</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>utm <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;EPSG:32613&#34;</span>  <span style="color:#75715e"># UTM Zone 13N for Jalisco</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_grids</span>(
</span></span><span style="display:flex;"><span>        gdf:gpd<span style="color:#f92672">.</span>GeoDataFrame,
</span></span><span style="display:flex;"><span>        utm:str,
</span></span><span style="display:flex;"><span>        grid_size:int<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>) <span style="color:#f92672">-&gt;</span> gpd<span style="color:#f92672">.</span>GeoDataFrame:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Creates a grid map over given neighborhoods (GeoDataFrame) with the
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    objective of using those grids for maps APIs later and handle the
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    results limit for each API.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param gpd.GeoDataFrame gdf: neighborhoods geo data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param str utm: UTM Zone for the analyzed geographic area
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param int grid_size: side size of the square (in meters)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return: geodataframe with the grids&#39; center (lat/lon), geometry and
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    associated neighborhood
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :rtype: gpd.GeoDataFrame
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    gdf <span style="color:#f92672">=</span> gdf<span style="color:#f92672">.</span>to_crs(utm)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get total bounds of all neighborhoods</span>
</span></span><span style="display:flex;"><span>    minx, miny, maxx, maxy <span style="color:#f92672">=</span> gdf<span style="color:#f92672">.</span>total_bounds
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Create 1km grid cells</span>
</span></span><span style="display:flex;"><span>    x_coords <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(minx, maxx, grid_size)
</span></span><span style="display:flex;"><span>    y_coords <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(miny, maxy, grid_size)
</span></span><span style="display:flex;"><span>    grid_cells <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        box(x, y, x <span style="color:#f92672">+</span> grid_size, y <span style="color:#f92672">+</span> grid_size) 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> x_coords 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> y_coords
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Keep overlapping neighborhoods only</span>
</span></span><span style="display:flex;"><span>    grid <span style="color:#f92672">=</span> gpd<span style="color:#f92672">.</span>GeoDataFrame(geometry<span style="color:#f92672">=</span>grid_cells, crs<span style="color:#f92672">=</span>utm)
</span></span><span style="display:flex;"><span>    grid <span style="color:#f92672">=</span> grid[grid<span style="color:#f92672">.</span>intersects(gdf<span style="color:#f92672">.</span>union_all())]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Spatial join to assign neighborhood names to grid cells</span>
</span></span><span style="display:flex;"><span>    grid <span style="color:#f92672">=</span> gpd<span style="color:#f92672">.</span>sjoin(
</span></span><span style="display:flex;"><span>        grid, gdf[[<span style="color:#e6db74">&#34;neighborhood&#34;</span>, <span style="color:#e6db74">&#34;geometry&#34;</span>]],
</span></span><span style="display:flex;"><span>        how<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;left&#34;</span>,
</span></span><span style="display:flex;"><span>        predicate<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;intersects&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Add centroid coordinates (for API calls)</span>
</span></span><span style="display:flex;"><span>    grid[<span style="color:#e6db74">&#34;center&#34;</span>] <span style="color:#f92672">=</span> grid<span style="color:#f92672">.</span>geometry<span style="color:#f92672">.</span>centroid
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Convert centroids back to WGS84 (EPSG:4326) for APIs</span>
</span></span><span style="display:flex;"><span>    grid[<span style="color:#e6db74">&#34;center_wgs84&#34;</span>] <span style="color:#f92672">=</span> grid[<span style="color:#e6db74">&#34;center&#34;</span>]<span style="color:#f92672">.</span>to_crs(<span style="color:#e6db74">&#34;EPSG:4326&#34;</span>)
</span></span><span style="display:flex;"><span>    grid[<span style="color:#e6db74">&#34;api_lon&#34;</span>] <span style="color:#f92672">=</span> grid[<span style="color:#e6db74">&#34;center_wgs84&#34;</span>]<span style="color:#f92672">.</span>x
</span></span><span style="display:flex;"><span>    grid[<span style="color:#e6db74">&#34;api_lat&#34;</span>] <span style="color:#f92672">=</span> grid[<span style="color:#e6db74">&#34;center_wgs84&#34;</span>]<span style="color:#f92672">.</span>y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> grid[[<span style="color:#e6db74">&#34;neighborhood&#34;</span>, <span style="color:#e6db74">&#34;api_lon&#34;</span>, <span style="color:#e6db74">&#34;api_lat&#34;</span>, <span style="color:#e6db74">&#34;geometry&#34;</span>]]
</span></span></code></pre></div><!--delete from here #######################################################-->
<iframe
 width="100%" height="500px"
src='/graphs/ex.html'></iframe>
        
    </div>

    <div class="prev-next">
        
            
                
<div class="prev-post">
    <p>
        <a href="/posts/thesis/get_properties/">
            &#8592;
            Previous:
            Get_properties
        </a>
    </p>
    <p class="prev-post-date">
        June 2, 2025
    </p>
</div>



<div class="next-post">
    <p>
        <a href="/posts/programming/regex/">
            Next:
            Regular expressions (regex)
            &#8594;
        </a>
    </p>
        <p class="next-post-date">
            May 10, 2025
        </p>
</div>


            
        
    </div>

    
    
        <svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top">
    
    <path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/>
</svg>
<script>
    let backToTopButton = document.getElementById("btt-button");

    window.onscroll = function() {
        scrollFunction()
    };

    function scrollFunction() {
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            backToTopButton.style.display = "block";
        } else {
            backToTopButton.style.display = "none";
        }
    }

    function scrollToTop() {
        window.scrollTo(0, 0);
    }
</script>

    
    
</div>

<aside class="post-toc">
    <nav id="toc">
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#grid-creation">Grid creation</a>
          <ul>
            <li><a href="#step-by-step">Step by step</a></li>
            <li><a href="#code">Code</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
    </nav>
</aside>



    

        </main><footer class="footer">
    
    

    

    

        
            
        

        

        
        

        

    

    
        <span>&copy; 2025 Gustavo Santana</span>
    

    <span>
        Powered by <a href="https://gohugo.io">Hugo</a> and
        <a target="_blank" href="https://github.com/gokarna-theme/gokarna-hugo">Gokarna</a>
    </span>
</footer>
</body>
</html>
